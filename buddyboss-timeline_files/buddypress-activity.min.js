window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.Activity={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(t(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:t(document).prop("title")},void 0!==window.Dropzone&&void 0!==BP_Nouveau.media&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options)),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.dropzone_video_obj=null,this.dropzone_video=[],this.models=[],this.InitiatedCommentForms=[],this.activityHasUpdates=!1,this.currentActivityId=null,this.activityPinHasUpdates=!1},addListeners:function(){t("body").hasClass("activity-singular")||t("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this)),t("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),t(".actvity-head-bar").length&&(t(".actvity-head-bar").addClass("activity-head-bar").removeClass("actvity-head-bar"),t(".activity-head-bar > nav.activity-type-navs").length&&t(".activity-head-bar .bb-subnav-filters-filtering").length&&t(".activity-head-bar > nav.activity-type-navs").remove()),t('#buddypress [data-bp-list="activity"]:not( #bb-schedule-posts_modal [data-bp-list="activity"] )').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this)),void 0!==BP_Nouveau.is_send_ajax_request&&"1"===BP_Nouveau.is_send_ajax_request?t("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)):t(window).on("load",function(){setTimeout((function(){bp.Nouveau.Activity.openEditActivityPopup()}).bind(this),0)}),t("#activity-stream").on("click",".acomments-view-more",this.showActivity),t("body").on("click",".bb-close-action-popup",this.closeActivity),t(document).on("activityModalOpened",(function(e,a){var i=a.activityId;t(document).on("click",".bb-activity-model-wrapper.activity-theatre",(function(e){!(t("#activity-modal:visible").length>0)||0!==t("#bp-nouveau-activity-form-placeholder:visible").length||t(e.target).closest("#activity-modal").length||t(e.target).closest(".gif-media-search-dropdown-standalone").length||t(e.target).closest(".emojionearea-theatre").length||t(e.target).hasClass("dz-hidden-input")||(this.closeActivity(e),this.activitySyncOnModalClose(e,i))}).bind(this))}).bind(this)),t('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),t('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this)),t('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this)),t('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),t("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),t(".bb-activity-model-wrapper").on("click",".ac-form-placeholder",bp.Nouveau,this.activityRootComment.bind(this)),t(document).keydown(this.commentFormAction),t(document).click(this.togglePopupDropdown),t('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal .activity-list, .bb-modal-activity-footer').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),t('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal .activity-list, .bb-modal-activity-footer').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this)),t('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal .activity-list, .bb-modal-activity-footer').on("click",".ac-reply-video-button",this.openCommentsVideoUploader.bind(this)),t('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal .activity-list, .bb-modal-activity-footer').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this)),t(document).on("click",".activity-state-popup_overlay",bp.Nouveau,this.closeActivityState.bind(this)),t(document).on("click",".activity-state-popup .activity-state-popup_tab_panel a",this.ReactionStatePopupTab),_.isUndefined(BP_Nouveau.activity.params.autoload)||t(window).scroll(this.loadMoreActivities),t(document).on("click",".bb-subnav-filters-container .subnav-filters-opener",this.openActivityFilter.bind(this)),t(document).on("click",this.closeActivityFilter.bind(this)),t(document).on("click",".bb-subnav-filters-container .subnav-filters-modal a",this.filterActivity.bind(this)),t(".bb-activity-model-wrapper, .bb-media-model-wrapper").on("click",".acomments-view-more",this.viewMoreComments.bind(this)),t(document).on("click","#activity-stream .activity-comments .view-more-comments, #activity-stream .activity-state-comments > .comments-count",function(e){e.preventDefault(),t(this).parents("li.activity-item").find(".activity-comments > ul > li.acomments-view-more, .activity-comments > .activity-actions > ul > li.acomments-view-more").trigger("click")}),t("#activity-modal > .bb-modal-activity-body").on("scroll",this.autoloadMoreComments.bind(this)),t("#activity-modal > .bb-modal-activity-body").on("scroll",this.discardGifEmojiPicker.bind(this)),t(".bb-activity-model-wrapper .bb-model-close-button").on("click",this.activitySyncOnModalClose.bind(this)),void 0!==BP_Nouveau.is_send_ajax_request&&"1"===BP_Nouveau.is_send_ajax_request?t("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',function(){setTimeout(function(){t(".ac-form.not-initialized").each(function(){var e=t(this),a=e.find(".ac-textarea");bp.Nouveau.Activity.toggleMultiMediaOptions(e,a)})},1e3)}):setTimeout(function(){t(".ac-form.not-initialized").each(function(){var e=t(this),a=e.find(".ac-textarea");bp.Nouveau.Activity.toggleMultiMediaOptions(e,a)})},1e3)},heartbeatSend:function(e,a){if(t(bp.Nouveau.objectNavParent+" [data-bp-orderby=date_updated].selected").length){var i=t("#buddypress [data-bp-list] [data-bp-activity-id]:not(.bb-pinned)").first();if(void 0!==i.data("bb-updated-timestamp"))this.heartbeat_data.first_recorded=i.data("bb-updated-timestamp");else if(i.length&&void 0!==i.data("bp-activity").date_updated&&""!==i.data("bp-activity").date_updated){var o=new Date(i.data("bp-activity").date_updated.replace(" ","T")+"Z").getTime()/1e3;this.heartbeat_data.first_recorded=o}else this.heartbeat_data.first_recorded=i.data("bp-timestamp")||0}else this.heartbeat_data.first_recorded=t("#buddypress [data-bp-list] [data-bp-activity-id]:not(.bb-pinned)").first().data("bp-timestamp")||0;var s=t("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0;s>this.heartbeat_data.first_recorded&&(this.heartbeat_data.first_recorded=s),(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),a.bp_activity_last_recorded=this.heartbeat_data.last_recorded,t("#buddypress .activity-head-bar .activity-search input[type=search]").length&&(a.bp_activity_last_recorded_search_terms=t("#buddypress .activity-head-bar .activity-search input[type=search]").val()),t.extend(a,{bp_heartbeat:function(){var e={scope:"all"};if(t("body.my-activity:not(.activity-singular)").length?e=bp.Nouveau.getStorage("bp-user-activity")||{scope:"just-me"}:(e=bp.Nouveau.getStorage("bp-activity")||{scope:"all"},t("body.activity.buddypress.groups.single-item").length&&(e.scope="all")),t(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").length){var a=t(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").data("bp-scope");(void 0===e.scope||e.scope!==a)&&(e.scope=a,"undefined"!==BP_Nouveau.is_send_ajax_request&&"1"===BP_Nouveau.is_send_ajax_request&&(t("body.my-activity:not(.activity-singular)").length?bp.Nouveau.setStorage("bp-user-activity","scope",a):bp.Nouveau.setStorage("bp-activity","scope",a)))}if(t(bp.Nouveau.objectNavParent+" [data-bp-order].selected").length){var i=t(bp.Nouveau.objectNavParent+" [data-bp-order].selected").data("bp-orderby");e.order_by=i}return e}()})},heartbeatTick:function(e,a){var i,o,s=bp.Nouveau.objects,d=bp.Nouveau.getStorage("bp-activity","scope"),n=this;if(void 0!==a&&a.bp_activity_newest_activities){if(this.heartbeat_data.newest=t.trim(a.bp_activity_newest_activities.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(a.bp_activity_newest_activities.last_recorded),i=Number((o=t(this.heartbeat_data.newest).filter(".activity-item")).length),s.push("mentions"),"all"===d){t.each(o,function(e,a){a=t(a),t.each(s,function(e,i){-1!==t.inArray("bp-my-"+i,a.get(0).classList)&&(void 0===n.heartbeat_data.highlights[i]?n.heartbeat_data.highlights[i]=[a.data("bp-activity-id")]:-1===t.inArray(a.data("bp-activity-id"),n.heartbeat_data.highlights[i])&&n.heartbeat_data.highlights[i].push(a.data("bp-activity-id")))})});var r=RegExp("bp-my-("+s.join("|")+")","g");this.heartbeat_data.newest=this.heartbeat_data.newest.replace(r,""),t(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(i)}else this.heartbeat_data.highlights[d]=[],t.each(o,function(e,a){n.heartbeat_data.highlights[d].push(t(a).data("bp-activity-id"))});if(t.each(s,function(e,a){if(void 0!==n.heartbeat_data.highlights[a]&&n.heartbeat_data.highlights[a].length){var i=0;"mentions"===a&&(i=n.mentions_count),t(bp.Nouveau.objectNavParent+' [data-bp-scope="'+a+'"]').find("a span").html(Number(n.heartbeat_data.highlights[a].length)+i)}}),s.pop(),t(document).prop("title","("+i+") "+this.heartbeat_data.document_title),t('#buddypress [data-bp-list="activity"]').first().hasClass("load-newest")){var c=t('#buddypress [data-bp-list="activity"] .load-newest a').html();t('#buddypress [data-bp-list="activity"] .load-newest a').html(c.replace(/([0-9]+)/,i))}else t('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+i+")</a></li>");t('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click"),t('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp()}},injectActivities:function(e){var a=t("body.my-activity:not(.activity-singular)").length?bp.Nouveau.getStorage("bp-user-activity"):bp.Nouveau.getStorage("bp-activity"),i=a.scope||null,o=a.filter||null;if(t(e.currentTarget).hasClass("load-newest")){e.preventDefault(),t(e.currentTarget).remove();var s=t.parseHTML(this.heartbeat_data.newest);t.each(s,function(e,a){"LI"===a.nodeName&&t(a).hasClass("just-posted")&&t("#"+t(a).prop("id")).length&&t("#"+t(a).prop("id")).remove()});var d=t(e.delegateTarget).find(".activity-list .activity-item").first();d.length>0&&d.hasClass("bb-pinned")?t(d).after(this.heartbeat_data.newest).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data):t(e.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===i&&t(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===i&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),t(bp.Nouveau.objectNavParent+' [data-bp-scope="'+i+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[i]&&(this.heartbeat_data.highlights[i]=[]),setTimeout(function(){t(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+i+"_activity")},3e3),t(document).prop("title",this.heartbeat_data.document_title),jQuery(window).scroll()}else if(t(e.currentTarget).hasClass("load-more")){var n=+Number(this.current_page)+1,r=this,c="";e.preventDefault();var l=t(e.currentTarget);l.find("a").first().addClass("loading"),this.just_posted=[],t(e.delegateTarget).children(".just-posted").each(function(){r.just_posted.push(t(this).data("bp-activity-id"))}),t("#buddypress .dir-search input[type=search]").length?c=t("#buddypress .dir-search input[type=search]").val():t("#buddypress .activity-search.bp-search input[type=search]").length&&(c=t("#buddypress .activity-search.bp-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"activity",scope:i,filter:o,search_terms:c,page:n,method:"append",exclude_just_posted:this.just_posted.join(","),target:'#buddypress [data-bp-list]:not( #bb-schedule-posts_modal [data-bp-list="activity"] ) ul.bp-list'}).done(function(e){!0===e.success&&(l.remove(),r.current_page=n,jQuery(window).scroll())})}t(".activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").hide()},hideComments:function(e){var a,i,o,s=t(e.target).find(".activity-comments");s.length&&s.each(function(e,s){o=t(s).children("ul").not(".conflict-activity-ul-li-comment"),(i=t(o).find("li").not(t(".document-action-class, .media-action-class, .video-action-class"))).length&&(t("body").hasClass("activity-singular")&&""!==window.location.hash&&t(window.location.hash).length&&0!==t(window.location.hash).closest(".activity-comments").length||(a=t(s).closest(".activity-item"),t("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html(),i.each(function(e,o){if(e<i.length-4){if(e||t(o).parent("ul").before('<div class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></div>"),window.location.hash&&"#"+t(o).attr("id")===window.location.hash)return t(o).parents("li.comment-item").show(),!1;t(o).addClass("bp-hidden").hide()}}),t(o).children(".bp-hidden").length===t(o).children("li").length-1&&t(o).find("li.show-all").length&&t(o).children("li:not(.show-all)").removeClass("bp-hidden").toggle()))})},showActivity:function(e){e.preventDefault();var a=t(e.currentTarget).parent(),i=a.data("parent_comment_id"),o=t(a).data("activity_id");t(document).trigger("activityModalOpened",{activityId:o}),t(e.currentTarget).parents(".activity-comments").find(".ac-form").each(function(){var e=t(this),a=t(this).closest(".activity-comments"),i=t(this).closest(".comment-item");e.find(".post-elements-buttons-item.post-emoji").removeClass("active").empty(""),bp.Nouveau.Activity.resetActivityCommentForm(e,"hardReset"),a.append(e),i.find(".acomment-display").removeClass("display-focus"),i.removeClass("comment-item-focus")}),bp.Nouveau.Activity.launchActivityPopup(o,i)},closeActivity:function(e){e.preventDefault();var a=t(e.target).closest(".bb-activity-model-wrapper"),i=a.find(".bb-modal-activity-footer"),o=a.find(".activity-item").data("bp-activity-id"),s=a.find("#ac-form-"+o);bp.Nouveau.Activity.reinitializeActivityCommentForm(s),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!1,"",o),a.find("#activity-modal").removeClass("bb-closed-comments"),a.closest("body").removeClass("acomments-modal-open"),a.hide(),a.find("ul.activity-list").empty(),i.removeClass("active"),i.find("form.ac-form").remove()},scopeLoaded:function(e,a){this.current_page=1,"mentions"===a.scope&&void 0!==a.response.new_mentions?(t.each(a.response.new_mentions,function(e,a){t("#buddypress #activity-stream").find('[data-bp-activity-id="'+a+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&t.each(this.heartbeat_data.highlights[a.scope],function(e,i){t("#buddypress #activity-stream").find('[data-bp-activity-id="'+i+'"]').length&&t("#buddypress #activity-stream").find('[data-bp-activity-id="'+i+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",t.each(t(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,a){0===parseInt(t(a).html(),10)&&t(a).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),t(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){t("#buddypress #activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(),this.fixAtWhoActivity(),this.openEditActivityPopup(),this.navigateToSpecificComment(),setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){if(!_.isUndefined(BP_Nouveau.activity.params.is_activity_edit)&&0<BP_Nouveau.activity.params.is_activity_edit){var e=t("#activity-"+BP_Nouveau.activity.params.is_activity_edit);if(e.length&&e.children(".bb-activity-more-options-wrap").find(".button.edit-activity").length){var a=e.data("bp-activity"),i=""!==e.data("link-url")?e.data("link-url"):null;_.isUndefined(a)||bp.Nouveau.Activity.postForm.displayEditActivityForm(a,i)}}},activityPrivacyChange:function(e){var a=e.data,i=t(e.target),o=t(e.currentTarget).closest(".activity-item"),s=o.data("bp-activity-id");if(e.preventDefault(),void 0===i.data("value")||""==t.trim(i.data("value")))return!1;o.find(".privacy").addClass("loading"),a.ajax({action:"activity_update_privacy",id:s,privacy:i.data("value")},"activity").done(function(e){o.find(".privacy").removeClass("loading"),!0===e.success&&(o.find(".activity-privacy li").removeClass("selected"),o.find(".privacy-wrap").attr("data-bp-tooltip",i.text()),i.addClass("selected"),o.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends"),o.find(".privacy").addClass(i.data("value")),void 0!==e&&void 0!==e.data&&void 0!==e.data.video_symlink&&(t(".document-description-wrap").length&&t(".document-description-wrap .bb-open-document-theatre").length&&(t(".document-description-wrap .bb-open-document-theatre").attr("data-video-preview",e.data.video_symlink),t(".document-description-wrap .bb-open-document-theatre").attr("data-extension",e.data.extension)),t(".document-description-wrap").length&&t(".document-detail-wrap.document-detail-wrap-description-popup").length&&(t(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-video-preview",e.data.video_symlink),t(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-extension",e.data.extension)),videojs(e.data.video_js_id).src({type:e.data.video_extension,src:e.data.video_symlink})),void 0!==e&&void 0!==e.data&&void 0!==e.data.edited_text&&""!==e.data.edited_text&&(o.find(".activity-date span.bb-activity-edited-text").length?o.find(".activity-date span.bb-activity-edited-text").replaceWith(e.data.edited_text):o.find(".activity-date").append(e.data.edited_text)),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=s)})},activityPrivacyRedirect:function(e){var a=t(e.target);if(e.preventDefault(),void 0===a.data("value")||""==t.trim(a.data("value")))return!1;window.location.href=a.data("value")},togglePrivacyDropdown:function(e){e.data,t(e.target);var a=t(e.currentTarget).closest(".activity-item");a.data("bp-activity-id"),e.preventDefault(),t("ul.activity-privacy").not(a.find(".activity-privacy")).removeClass("bb-open"),a.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(e){var a,i,o,s,d=e.data,n=t(e.target),r=t(e.currentTarget),c=r.data("bp-activity-id"),l=t(e.delegateTarget),m=r.find(".activity-state"),p=r.find(".comments-count"),v=this,u=n.closest("#activity-modal").length>0,b=n.closest(".bb-internal-model").length>0;u&&(m=r.closest("#activity-modal").find(".activity-state"),p=r.closest("#activity-modal").find(".comments-count")),(t(n).is("span")||t(n).is("i")||t(n).is("img"))&&(n=t(n).closest("a"));var f=0;if(n.parent(".ac-emotion_btn")&&!(n.hasClass("fav")||n.hasClass("unfav"))&&(f=n.parents(".ac-emotion_item").attr("data-reaction-id")),n.hasClass("fav")||n.hasClass("unfav")||f>0){if(e.preventDefault(),t("body").hasClass("bb-is-mobile")&&t("body").hasClass("bb-reactions-mode")&&0===n.closest(".ac-emotion_btn").length&&!0!==e.customTriggered||(t(n).is("a")||(n=t(n).closest("a")),n.hasClass("loading")))return;n.addClass("loading");var y,h=n.hasClass("fav")?"fav":"unfav",g=!0,C="activity",N=n.parents(".acomment-display").first(),w=n.attr("data-reacted-id");if(f>0&&(h="fav"),n.parent(".ac-emotion_btn")&&(w=n.parents(".bp-generic-meta").find(".unfav").attr("data-reacted-id")),"fav"===h&&parseInt(f)===parseInt(w))return void n.removeClass("loading");0<N.length&&(g=!1,C="activity_comment"),a=g?(y=n.parents(".activity-item")).data("bp-activity-id"):(y=n.parents(".activity-comment").first()).data("bp-activity-comment-id");var z={action:"activity_mark_"+h,reaction_id:f,item_id:a,item_type:C};d.ajax(z,"activity").done(function(e){if(!1===e.success){n.removeClass("loading"),alert(e.data);return}if(n.fadeOut(200,function(){"false"===t(this).attr("aria-pressed")?t(this).attr("aria-pressed","true"):t(this).attr("aria-pressed","false"),void 0!==e.data.reaction_count&&(g?(0<y.find(".activity-content .activity-state-reactions").length?y.find(".activity-content  .activity-state-reactions").replaceWith(e.data.reaction_count):y.find(".activity-content .activity-state").prepend(e.data.reaction_count),""!==e.data.reaction_count?m.addClass("has-likes"):m.removeClass("has-likes")):0<y.find("#acomment-display-"+a+" .comment-reactions .activity-state-reactions").length?y.find("#acomment-display-"+a+" .comment-reactions .activity-state-reactions").replaceWith(e.data.reaction_count):y.find("#acomment-display-"+a+" .comment-reactions").prepend(e.data.reaction_count)),e.data.reaction_button&&(g?y.find(".bp-generic-meta a.bp-like-button:first").replaceWith(e.data.reaction_button):y.find("#acomment-display-"+a+" .bp-generic-meta a.bp-like-button").replaceWith(e.data.reaction_button)),y.find(".ac-emotions_list").removeClass("active"),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=a,t(this).fadeIn(200),n.removeClass("loading")}),"activity_comment"===C?t(".activity-comment[data-bp-activity-comment-id="+a+"] > .acomment-display > .acomment_inner").find(".activity-state-reactions").parent().addClass("bb-has-reaction_update"):"activity"===C&&t(".activity[data-bp-activity-id="+a+"] > .activity-content").find(".activity-state-reactions").parent().addClass("bb-has-reaction_update"),"fav"===h)void 0===e.data.directory_tab||""===e.data.directory_tab||t(d.objectNavParent+' [data-bp-scope="favorites"]').length||t(d.objectNavParent+' [data-bp-scope="all"]').after(e.data.directory_tab);else if("unfav"===h){var i=t('[data-bp-user-scope="favorites"]').hasClass("selected")||t(d.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected");i&&r.remove(),void 0!==e.data.no_favorite&&(t(d.objectNavParent+' [data-bp-scope="all"]').length&&t(d.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?t(d.objectNavParent+' [data-bp-scope="favorites"]').remove():i&&l.append(e.data.no_favorite))}}).fail(function(){n.removeClass("loading")})}if(n.hasClass("delete-activity")||n.hasClass("acomment-delete")||n.hasClass("spam-activity")||n.hasClass("spam-activity-comment")){var P,j,B,x,k=n.closest("[data-bp-activity-comment-id]"),A=k.data("bp-activity-comment-id"),T=0;if((s=n.closest(".activity-comments")).addClass("active"),e.preventDefault(),void 0!==BP_Nouveau.confirm&&!1===window.confirm(BP_Nouveau.confirm))return!1;n.addClass("loading");var U={action:"delete_activity",id:c,_wpnonce:d.getLinkParams(n.prop("href"),"_wpnonce"),is_single:n.closest("[data-bp-single]").length};(n.hasClass("spam-activity")||n.hasClass("spam-activity-comment"))&&(U.action="bp_spam_activity"),P=r,A&&(delete U.is_single,U.id=A,U.is_comment=!0,P=k),d.ajax(U,"activity").done(function(e){if(n.removeClass("loading"),!1===e.success)P.append(e.data.feedback),P.find(".bp-feedback").hide().fadeIn(300);else{var a=P.closest(".has-child-comments");if(P.hasClass("has-child-comments"))var i=P.closest("ul").closest("li");var o=a.find("> ul");if(e.data.redirect)return window.location.href=e.data.redirect;if(e.data.parent_activity_id&&e.data.activity&&t("body:not(.activity-singular) #buddypress #activity-stream ul.activity-list li#activity-"+e.data.parent_activity_id).replaceWith(e.data.activity),A){T=1;var l=k.find(".acomments-view-more").data("child-count");if(r.append(k.find("form")),t.each(k.find("li.comment-item"),function(){T+=1}),T+=void 0!==l?parseFloat(l):0,B=Number((B=(j=m.find("span.comments-count")).text().length?j.text().match(/\d+/)[0]:0)-T),p.length){var v=B>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;p.text(v.replace("%d",B))}else j.parent(".has-comments").removeClass("has-comments");(x=r.find("li.show-all a")).length&&x.html(BP_Nouveau.show_x_comments.replace("%d",B)),0===B&&(r.removeClass("has-comments"),m.removeClass("has-comments"),p.empty())}P.slideUp(300,function(){P.remove(),0===o.find("li").length&&a.removeClass("has-child-comments"),void 0!==i&&""===i.find("> ul").html().trim()&&i.removeClass("has-child-comments")}),A||r.data("bp-timestamp")!==d.Activity.heartbeat_data.last_recorded||(d.Activity.heartbeat_data.newest="",d.Activity.heartbeat_data.last_recorded=0),t(document).trigger("bp_activity_ajax_delete_request",t.extend(U,{response:e})),t(document).trigger("bp_activity_ajax_delete_request_video",t.extend(U,{response:e})),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=c}s.removeClass("active")})}if(n.closest("span").hasClass("activity-read-more")){var F=n.closest("div"),M=n.closest("span");if(a=null,t(F).hasClass("activity-inner")?a=c:t(F).hasClass("acomment-content")&&(a=n.closest("li").data("bp-activity-comment-id")),!a)return e;e.preventDefault(),t(M).addClass("loading"),d.ajax({action:"get_single_activity_content",id:a},"activity").done(function(e){"object"!=typeof e&&n.closest("div").find(".bb-activity-media-wrap").length>0&&(e=JSON.parse(e)),t(M).removeClass("loading"),F.parent().find(".bp-feedback").length&&F.parent().find(".bp-feedback").remove(),!1===e.success?(F.after(e.data.feedback),F.parent().find(".bp-feedback").hide().fadeIn(300)):(t(F).children(".bb-poll-view").length?(t(F).children(":not(.bb-poll-view)").remove(),t(F).prepend(e.data.contents).slideDown(300)):t(F).html(e.data.contents).slideDown(300),jQuery(window).scroll(),r.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+a))))})}if(n.hasClass("ac-form")&&n.hasClass("not-initialized")&&n.closest(".activity-item").find(".acomment-reply").eq(0).trigger("click"),n.hasClass("activity-state-comments")||n.hasClass("acomment-reply")||n.parent().hasClass("acomment-reply")||n.hasClass("acomment-edit")){if(n.parents(".activity-item").hasClass("bb-closed-comments"))return void e.preventDefault();a=c,u?(i=t("#activity-modal").find("#ac-form-"+c),D=t("#activity-modal").find(".bb-modal-activity-footer"),E="#activity-modal "):b?(i=t(".bb-internal-model").find("#ac-form-"+c),E=".bb-internal-model "):(i=t("#ac-form-"+c),D=t('[data-bp-activity-id="'+a+'"] .activity-comments'),E="");var E,D,L,I,H,G=!1;if(n.closest(".bb-media-model-container").length&&(i=n.closest(".bb-media-model-container").find("#ac-form-"+c),D=n.closest(".bb-media-model-container").find('[data-bp-activity-id="'+a+'"] .activity-comments')),n.closest(".activity-item").hasClass("has-comments")||n.closest(".activity-item").addClass("has-comments"),e.preventDefault(),v.resetActivityCommentForm(i,"hardReset"),n.parent().hasClass("acomment-reply")&&n.parent(),n.closest("li").data("bp-activity-comment-id")&&(a=n.closest("li").data("bp-activity-comment-id")),n.closest("li").data("bp-activity-comment")&&(G=n.closest("li").data("bp-activity-comment")),this.toggleMultiMediaOptions(i,n),i.removeClass("root"),t(".ac-form").addClass("not-initialized"),t(".ac-form").find(".ac-input:not(.emojionearea)").html(""),bp.Nouveau.Activity.clearFeedbackNotice(i),t.each(i.children("div"),function(e,a){t(a).hasClass("error")&&t(a).remove()}),n.hasClass("acomment-edit")&&!_.isNull(G)){var S=t(E+'[data-bp-activity-comment-id="'+a+'"]');S.find("#acomment-display-"+a).addClass("bp-hide"),S.find("#acomment-edit-form-"+a).append(i),i.addClass("acomment-edit").attr("data-item-id",a),v.validateCommentContent(i.find(".ac-textarea").children(".ac-input")),v.editActivityCommentForm(i,G),u&&t(".bb-modal-activity-footer").removeClass("active")}else a===c?(u&&(t(".bb-modal-activity-footer").addClass("active"),t("#activity-modal").find(".acomment-display").removeClass("display-focus"),t("#activity-modal").find(".comment-item").removeClass("comment-item-focus")),D.append(i),i.addClass("root"),D.find(".acomment-display").removeClass("display-focus"),D.find(".comment-item").removeClass("comment-item-focus")):u?(t(".bb-modal-activity-footer").removeClass("active"),t("#activity-modal").find('[data-bp-activity-comment-id="'+a+'"]').append(i)):b?t(".bb-internal-model").find('[data-bp-activity-comment-id="'+a+'"]').append(i):t('[data-bp-activity-comment-id="'+a+'"]').append(i);i.removeClass("not-initialized");var R=i.find(".post-elements-buttons-item.post-emoji").prevAll().not(":hidden").length+1;i.find(".post-elements-buttons-item.post-emoji").attr("data-nth-child",R);var O=i.find(".post-elements-buttons-item.post-gif").prevAll().not(":hidden").length+1;i.find(".post-elements-buttons-item.post-gif").attr("data-nth-child",O);var Q=i.find(".ac-input[contenteditable]");bp.Nouveau.Activity.listenCommentInput(Q),n.attr("aria-expanded","true"),n.closest(".activity-comments").find(".acomment-display").removeClass("display-focus"),n.closest(".activity-comments").find(".comment-item").removeClass("comment-item-focus"),n.closest(".acomment-display").addClass("display-focus"),n.closest(".comment-item").addClass("comment-item-focus"),_.isNull(G)||(L=G.nickname),_.isNull(G)||(I=G.user_id);var q='<span class="atwho-inserted" data-atwho-at-query="@" contenteditable="false">@'+L+"</span>&nbsp;";_.isUndefined(BP_Nouveau.activity.params.user_id)||(H=BP_Nouveau.activity.params.user_id);var V={offset:-(t(window).height()/2-75),easing:"swing"},W=Q.get(0);if(jQuery("body").hasClass("bb-is-mobile")?setTimeout(function(){var e=jQuery(window).height()>300?200:100;jQuery("html, body").animate({scrollTop:jQuery(W).offset().top-e},500)},500):u?t(".bb-modal-activity-body").scrollTo(i,500,V):t.scrollTo(i,500,V),t(E+"#ac-form-"+c+" #ac-input-"+c).focus(),!_.isUndefined(BP_Nouveau.media)&&!_.isUndefined(BP_Nouveau.media.emoji)&&void 0===t(E+"#ac-input-"+c).data("emojioneArea")){var Z=t(E+"#ac-input-"+c).html();bp.Nouveau.Activity.initializeEmojioneArea(u,E,c),n.hasClass("acomment-edit")&&!_.isNull(G)&&t(E+"#ac-input-"+c).html(Z)}if(n.hasClass("acomment-edit")||n.hasClass("button")||n.hasClass("activity-state-comments")||H===I||(t(E+"#ac-input-"+c).html(q),i.addClass("has-content")),void 0!==window.getSelection&&void 0!==document.createRange&&!_.isNull(G)){var J=document.createRange();J.selectNodeContents(t(E+"#ac-input-"+c)[0]),J.collapse(!1);var K=window.getSelection();K.removeAllRanges(),K.addRange(J)}_.isUndefined(window.MediumEditor)||t(E+"#ac-input-"+c).hasClass("medium-editor-element")||(window.activity_comment_editor=new window.MediumEditor(t(E+"#ac-input-"+c)[0],{placeholder:!1,toolbar:!1,paste:{forcePlainText:!1,cleanPastedHTML:!1},keyboardCommands:!1,imageDragging:!1,anchorPreview:!1}))}if(n.hasClass("activity-state-no-comments")&&e.preventDefault(),n.hasClass("ac-reply-cancel")){var X=t(n).closest(".ac-form");X.addClass("not-initialized"),t(".acomment-reply").attr("aria-expanded","false"),v.destroyCommentMediaUploader(c),v.destroyCommentDocumentUploader(c),v.resetActivityCommentForm(X),e.preventDefault()}if("ac_form_submit"===n.prop("name")){n.prop("disabled",!0),(s=n.closest(".activity-comments")).addClass("active"),i=n.closest("form"),a=c,e.preventDefault(),n.closest("li").data("bp-activity-comment-id")&&(a=n.closest("li").data("bp-activity-comment-id"));for(var $,Y=t(i).find(".ac-input").first(),ee=Y.find("span.atwho-query"),et=0;et<ee.length;et++)t(ee[et]).replaceWith(ee[et].innerText);Y.find("img.emoji").each(function(e,a){t(a).addClass("emojioneemoji");var i=t(a).attr("alt");t(a).attr("data-emoji-char",i),t(a).removeClass("emoji")}),Y.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),void 0===c&&n.parents(".bb-modal-activity-footer").length>0&&(a=c=n.parents("form.ac-form").find("input[name=comment_form_id]").val()),n.parent().addClass("loading").prop("disabled",!0),Y.addClass("loading").prop("disabled",!0);var ea=Y[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,"");$={action:"new_activity_comment",_wpnonce_new_activity_comment:t("#_wpnonce_new_activity_comment").val(),comment_id:a,form_id:c,content:ea},t("#_bp_as_nonce_"+c).val()&&($["_bp_as_nonce_"+c]=t("#_bp_as_nonce_"+c).val()),this.dropzone_media.length&&($.media=this.dropzone_media),this.dropzone_document.length&&($.document=this.dropzone_document),this.dropzone_video.length&&($.video=this.dropzone_video,_.isEmpty($.content)&&($.content="&#8203;")),_.isUndefined(this.models[c])||(o=this.models[c],$.gif_data=this.models[c].get("gif_data")),$.content=$.content.replace(/&nbsp;/g," "),i.hasClass("acomment-edit")&&($.edit_comment=!0);var ei=n.closest(".bb-modal-activity-footer").length>0;d.ajax($,"activity").done(function(e){if(n.parent().removeClass("loading"),Y.removeClass("loading"),t(".acomment-reply").attr("aria-expanded","false"),!1===e.success)i.append(t(e.data.feedback).hide().fadeIn(200));else{var a,d=n.closest(".elementor-activity-item").length>0,l=i.prev().hasClass("activity-actions");a=d&&l?i.parent().find(".activity-actions"):i.parent();var b=t.trim(e.data.contents);a.find(".acomment-display").removeClass("display-focus"),a.find(".comment-item").removeClass("comment-item-focus"),a.addClass("has-child-comments");var f=i.find('input[name="comment_form_id"]').val();if(u?(t("#activity-modal").find(".bb-modal-activity-footer").append(i).addClass("active"),i.removeClass("has-content").addClass("root")):(i.addClass("not-initialized").removeClass("has-content has-gif has-media"),i.closest(".activity-comments").append(i)),i.find("#ac-input-"+f).html(""),i.hasClass("acomment-edit")){var y=i.attr("data-item-id");i.closest(".activity-comments").append(i),u?t("#activity-modal").find("li#acomment-"+y).replaceWith(b):t("li#acomment-"+y).replaceWith(b)}else 0===a.children("ul").length&&(a.hasClass("activity-comments")?a.prepend("<ul></ul>"):a.append("<ul></ul>")),ei?i.closest("#activity-modal").find(".bb-modal-activity-body .activity-comments, .bb-modal-activity-body .activity-comments .activity-actions").children("ul").append(t(b)):a.children("ul").append(t(b).hide().fadeIn(200)),t(i).find(".ac-input").first().html(""),a.parent().addClass("has-comments"),a.parent().addClass("comments-loaded"),m.addClass("has-comments");i.removeClass("acomment-edit");var h=i.find(".ac-reply-content");if(h.find(".ac-reply-toolbar .ac-reply-media-button").length>0&&h.find(".ac-reply-toolbar .ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),h.find(".ac-reply-toolbar .ac-reply-document-button").length>0&&h.find(".ac-reply-toolbar .ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),h.find(".ac-reply-toolbar .ac-reply-video-button").length>0&&h.find(".ac-reply-toolbar .ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),h.find(".ac-reply-toolbar .ac-reply-gif-button").length>0&&(h.find(".ac-reply-toolbar .ac-reply-gif-button").removeClass("active "),h.find(".ac-reply-toolbar .ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable no-click")),jQuery(window).scroll(),!i.hasClass("acomment-edit")){if(B=Number(B=(j=m.find("span.comments-count")).text().length?j.text().match(/\d+/)[0]:0)+1,p.length){var g=B>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;p.text(g.replace("%d",B||1))}j.parent(":not( .has-comments )").addClass("has-comments"),(x=t(r).find(".show-all a"))&&x.html(BP_Nouveau.show_x_comments.replace("%d",B))}if(v.dropzone_media.length)for(var C=0;C<v.dropzone_media.length;C++)v.dropzone_media[C].saved=!0;if(v.dropzone_document.length)for(var N=0;N<v.dropzone_document.length;N++)v.dropzone_document[N].saved=!0;if(v.dropzone_video.length)for(var w=0;w<v.dropzone_video.length;w++)v.dropzone_video[w].saved=!0;bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=c}_.isUndefined(o)||(o.set("gif_data",{}),t("#ac-reply-post-gif-"+c).find(".activity-attached-gif-container").removeAttr("style")),v.destroyCommentMediaUploader(c),v.destroyCommentDocumentUploader(c),v.destroyCommentVideoUploader(c),n.prop("disabled",!1),Y.prop("disabled",!1),s.removeClass("active"),bp.Nouveau.Activity.clearFeedbackNotice(i)}).fail(function(e){if(n.parent().removeClass("loading"),n.prop("disabled",!1),bp.Nouveau.Activity.clearFeedbackNotice(i),0===e.readyState)i.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+BP_Nouveau.activity.strings.commentPostError+"</div>");else{var t=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:e.statusText;i.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+t+"</div>")}})}if(n.hasClass("edit")&&n.hasClass("edit-activity")){e.preventDefault();var eo=r.data("bp-activity"),es=""!==r.data("link-url")?r.data("link-url"):null;void 0!==eo&&(bp.Nouveau.Activity.postForm.displayEditActivityForm(eo,es),n.closest("li").hasClass("groups")?t("#bp-nouveau-activity-form").addClass("group-activity"):t("#bp-nouveau-activity-form").removeClass("group-activity"),void 0!==bp.Nouveau.Media&&void 0!==bp.Nouveau.Media.Theatre&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)&&(t(document).find(".bb-close-media-theatre").trigger("click"),t(document).find(".bb-close-document-theatre").trigger("click")))}if(u&&(n.hasClass("bb-open-media-theatre")||n.hasClass("bb-open-video-theatre")||n.hasClass("bb-open-document-theatre")||n.hasClass("document-detail-wrap-description-popup"))&&(e.preventDefault(),n.closest("#activity-modal").find(".bb-modal-activity-header .bb-close-action-popup").trigger("click")),n.hasClass("pin-activity")||n.hasClass("unpin-activity")){if(e.preventDefault(),!c)return e;n.closest(".activity-item").addClass("loading-pin");var ed="pin";n.hasClass("unpin-activity")&&(ed="unpin"),d.ajax({action:"activity_update_pinned_post",id:c,pin_action:ed},"activity").done(function(e){if(n.closest(".activity-item").removeClass("loading-pin"),"object"!=typeof e&&(e=JSON.parse(e)),void 0!==e.data&&void 0!==e.data.feedback){var a=n.closest("ul.activity-list"),i=n.closest(".buddypress-wrap:not(.bb-internal-model)").find("#activity-stream"),o=n.closest(".bb-media-model-wrapper").length>0,s=i.children("ul.activity-list"),d=s.children("[data-bp-activity-id="+c+"]"),r="."+n.attr("class").split(" ").join("."),l=d.find(r);if(e.success){var m=bp.Nouveau.getStorage("bp-activity","scope");(""===m||!1===m||"undefined"!==BP_Nouveau.is_send_ajax_request&&""===BP_Nouveau.is_send_ajax_request)&&t(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").length&&(m=t(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").data("bp-scope"));var p=!1,v=!1,b="";if(n.closest("li.activity-item").hasClass("groups")&&(v=!0,b=(b=n.closest("li.activity-item").attr("class").match(/group-\d+/))[0].replace("group-","")),i.hasClass("single-user")?p=!1:i.hasClass("activity")&&"all"===m&&!v?p=!0:i.hasClass("single-group")&&(p=!0),"pin"===ed){p&&a.find("li.activity-item").removeClass("bb-pinned");var f="li.activity-item:not(.groups)";v&&!i.hasClass("single-group")?f="li.activity-item.group-"+b:v&&i.hasClass("single-group")&&(f="li.activity-item"),a.find(f).each(function(){var e=t(this).find(".unpin-activity");e.removeClass("unpin-activity").addClass("pin-activity"),v?e.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):e.find("span").html(BP_Nouveau.activity.strings.pinPost)}),(u||o)&&s.length>0&&s.find(f).each(function(){var e=t(this).find(".unpin-activity");e.removeClass("unpin-activity").addClass("pin-activity"),v?e.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):e.find("span").html(BP_Nouveau.activity.strings.pinPost)}),p&&n.closest("li.activity-item").addClass("bb-pinned"),n.addClass("unpin-activity"),n.removeClass("pin-activity"),n.closest("li.activity-item").hasClass("groups")?n.find("span").html(BP_Nouveau.activity.strings.unpinGroupPost):n.find("span").html(BP_Nouveau.activity.strings.unpinPost),(u||o)&&l.length>0&&(l.addClass("unpin-activity"),l.removeClass("pin-activity"),l.closest("li.activity-item").hasClass("groups")?l.find("span").html(BP_Nouveau.activity.strings.unpinGroupPost):l.find("span").html(BP_Nouveau.activity.strings.unpinPost))}else"unpin"===ed&&(n.closest("li.activity-item").removeClass("bb-pinned"),n.addClass("pin-activity"),n.removeClass("unpin-activity"),n.closest("li.activity-item").hasClass("groups")?n.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):n.find("span").html(BP_Nouveau.activity.strings.pinPost),(u||o)&&l.length>0&&(l.addClass("pin-activity"),l.removeClass("unpin-activity"),l.closest("li.activity-item").hasClass("groups")?l.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):l.find("span").html(BP_Nouveau.activity.strings.pinPost)));p&&(u||o?void 0!==bp.Nouveau.Activity.activityPinHasUpdates&&(bp.Nouveau.Activity.activityPinHasUpdates=!0):(bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities()))}t(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>",e.success?"success":"error",null,!0]),u&&(void 0!==bp.Nouveau.Activity.activityHasUpdates&&(bp.Nouveau.Activity.activityHasUpdates=!0),void 0!==bp.Nouveau.Activity.activityPinHasUpdates&&(bp.Nouveau.Activity.activityPinHasUpdates=!0))}}).fail(function(){n.closest(".activity-item").removeClass("loading-pin"),t(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.pinPostError+"</div>","error",null,!0])})}if(n.hasClass("bb-icon-bell-slash")||n.hasClass("bb-icon-bell")){if(e.preventDefault(),!c)return e;n.closest(".activity-item").addClass("loading-mute");var en="mute";n.hasClass("bb-icon-bell")&&(en="unmute"),d.ajax({action:"toggle_activity_notification_status",id:c,notification_toggle_action:en},"activity").done(function(e){n.closest(".activity-item").removeClass("loading-mute"),"object"!=typeof e&&(e=JSON.parse(e)),void 0!==e.data&&void 0!==e.data.feedback&&(e.success&&("mute"===en?(n.closest("li.activity-item").addClass("bb-muted"),n.removeClass("bb-icon-bell-slash"),n.addClass("bb-icon-bell"),n.attr("title",BP_Nouveau.activity.strings.unmuteNotification),n.find("span").html(BP_Nouveau.activity.strings.unmuteNotification)):"unmute"===en&&(n.closest("li.activity-item").removeClass("bb-muted"),n.removeClass("bb-icon-bell"),n.addClass("bb-icon-bell-slash"),n.attr("title",BP_Nouveau.activity.strings.muteNotification),n.find("span").html(BP_Nouveau.activity.strings.muteNotification)),void 0!==bp.Nouveau.Activity.activityHasUpdates&&(bp.Nouveau.Activity.activityHasUpdates=!0)),t(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>","success",null,!0])),u&&(bp.Nouveau.Activity.activityPinHasUpdates=!0),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=c}).fail(function(){n.closest(".activity-item").removeClass("loading-pin"),t(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.pinPostError+"</div>","error",null,!0])})}if(n.hasClass("close-activity-comment")||n.hasClass("unclose-activity-comment")){if(e.preventDefault(),!c)return e;n.closest(".activity-item").addClass("loading-pin");var er="close_comments";n.hasClass("unclose-activity-comment")&&(er="unclose_comments"),d.ajax({action:"activity_update_close_comments",id:c,close_comments_action:er},"activity").done(function(e){if(n.closest(".activity-item").removeClass("loading-pin"),"object"!=typeof e&&(e=JSON.parse(e)),void 0!==e.data&&void 0!==e.data.feedback){if(e.success){var a=t("#activity-stream > .activity-list").find("[data-bp-activity-id="+c+"]");n.closest(".activity-item").find(".bb-activity-closed-comments-notice").remove(),"close_comments"===er?(n.closest("li.activity-item").addClass("bb-closed-comments"),n.closest("#activity-modal").length>0&&n.closest("#activity-modal").addClass("bb-closed-comments"),n.addClass("unclose-activity-comment"),n.removeClass("close-activity-comment"),n.find("span").html(BP_Nouveau.activity.strings.uncloseComments),n.closest("li.activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),n.closest(".activity-item").find(".activity-comments").before('<div class="bb-activity-closed-comments-notice">'+e.data.feedback+"</div>"),n.parents(".bb-media-model-wrapper").length>0&&a.length>0&&(a.addClass("bb-closed-comments"),a.find(".bb-activity-more-options .close-activity-comment span").html(BP_Nouveau.activity.strings.uncloseComments),a.find(".bb-activity-more-options .close-activity-comment").addClass("unclose-activity-comment").removeClass("close-activity-comment"),a.find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),a.find(".activity-comments").before('<div class="bb-activity-closed-comments-notice">'+e.data.feedback+"</div>"))):"unclose_comments"===er&&(n.closest("li.activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").show(),n.closest("li.activity-item").removeClass("bb-closed-comments"),n.closest("#activity-modal").length>0&&n.closest("#activity-modal").removeClass("bb-closed-comments"),n.addClass("close-activity-comment"),n.removeClass("unclose-activity-comment"),n.find("span").html(BP_Nouveau.activity.strings.closeComments),n.parents(".bb-media-model-wrapper").length>0&&a.length>0&&(a.find(".edit-activity, .acomment-edit").parents(".generic-button").show(),a.removeClass("bb-closed-comments"),a.find(".bb-activity-more-options .unclose-activity-comment span").html(BP_Nouveau.activity.strings.closeComments),a.find(".bb-activity-more-options .unclose-activity-comment").addClass("close-activity-comment").removeClass("unclose-activity-comment"),a.find(".bb-activity-closed-comments-notice").html(""))),void 0!==bp.Nouveau.Activity.activityHasUpdates&&(bp.Nouveau.Activity.activityHasUpdates=!0)}t(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>",e.success?"success":"error",null,!0])}}).fail(function(){n.closest(".activity-item").removeClass("loading-pin"),t(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.closeCommentsError+"</div>","error",null,!0])})}},commentFormAction:function(e){var a,i;if((e=e||window.event).target?a=e.target:e.srcElement&&(a=e.srcElement),3===a.nodeType&&(a=a.parentNode),!0===e.altKey||!0===e.metaKey||"TEXTAREA"!==a.tagName||!t(a).hasClass("ac-input"))return e;27===(i=e.keyCode?e.keyCode:e.which)&&!1===e.ctrlKey?"TEXTAREA"===a.tagName&&t(a).closest("form").slideUp(200):e.ctrlKey&&13===i&&t(a).val()&&t(a).closest("form").find("[type=submit]").first().trigger("click")},togglePopupDropdown:function(e){var a;if((e=e||window.event).target?a=e.target:e.srcElement&&(a=e.srcElement),3===a.nodeType&&(a=a.parentNode),!0===e.altKey||!0===e.metaKey||t(a).hasClass("privacy-wrap")||t(a).parent().hasClass("privacy-wrap"))return e;t("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e=t(".load-more:visible").last(),a=t(window);if(e.closest(".activity-list").length&&!(!e.get(0)||e.data("bp-autoloaded"))){var i=e.offset().top-50;a.scrollTop()+a.height()>i&&(e.data("bp-autoloaded",1),e.find("a").text(BP_Nouveau.activity.strings.loadingMore),e.find("a").trigger("click"))}},destroyCommentMediaUploader:function(e){_.isNull(this.dropzone_obj)||(this.dropzone_obj.destroy(),t("#ac-reply-post-media-uploader-"+e).html(""),t("#ac-reply-post-media-uploader-1-"+e).html("")),this.dropzone_media=[],t("#ac-reply-post-media-uploader-"+e).removeClass("open").addClass("closed"),t("#ac-reply-media-button-"+e).removeClass("active")},destroyCommentDocumentUploader:function(e){_.isNull(this.dropzone_document_obj)||(this.dropzone_document_obj.destroy(),t("#ac-reply-post-document-uploader-"+e).html("")),this.dropzone_document=[],t("#ac-reply-post-document-uploader-"+e).removeClass("open").addClass("closed"),t("#ac-reply-document-button-"+e).removeClass("active")},destroyCommentVideoUploader:function(e){_.isNull(this.dropzone_video_obj)||(this.dropzone_video_obj.destroy(),t("#ac-reply-post-video-uploader-"+e).html("")),this.dropzone_video=[],t("#ac-reply-post-video-uploader-"+e).removeClass("open").addClass("closed"),t("#ac-reply-video-button-"+e).removeClass("active")},resetGifPicker:function(e){t("#ac-reply-gif-button-"+e).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open").empty(),t("#ac-reply-gif-button-"+e).removeClass("active"),t(".gif-media-search-dropdown-standalone").removeClass("open").empty(),_.isUndefined(this.models[e])||(this.models[e].set("gif_data",{}),t("#ac-reply-post-gif-"+e).find(".activity-attached-gif-container").removeAttr("style"))},openCommentsMediaUploader:function(e){var a=this,i=t(e.currentTarget),o=i.data("ac-id"),s=i.closest(".bp-ac-form-container").find("#ac-reply-post-media-uploader-"+o),d=i.closest("#activity-modal").length>0;if(e.preventDefault(),s.hasClass("open")&&!e.isCustomEvent){s.trigger("click"),s.removeClass("open").addClass("closed");return}var n=document.getElementsByClassName("ac-reply-post-default-template").length?document.getElementsByClassName("ac-reply-post-default-template")[0].innerHTML:"";if(void 0!==window.Dropzone&&s.length)if(s.hasClass("closed")){var r={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,thumbnailWidth:140,thumbnailHeight:140,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:n,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2};a.dropzone_obj instanceof Dropzone&&a.dropzone_obj.destroy(),a.dropzone_obj=new Dropzone((d?"#activity-modal ":"")+"#ac-reply-post-media-uploader-"+i.data("ac-id"),r),a.dropzone_obj.on("addedfile",function(e){if(e.media_edit_data){a.dropzone_media.push(e.media_edit_data);var t=i.parents(".ac-reply-toolbar");t.find(".ac-reply-media-button")&&t.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}}),a.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var o=i.parents(".ac-reply-toolbar"),s=i.closest(".ac-form");bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),s.addClass("has-media"),o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-video-button")&&o.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),a.dropzone_obj.on("uploadprogress",function(){i.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),a.dropzone_obj.on("success",function(e,i){if(i.data.id)return e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,i.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,i.data.saved=!1,a.dropzone_media.push(i.data),e.previewElement.classList.add("dz-success");var o,s,d,n,r,c=i.data.feedback;for(e.previewElement.classList.add("dz-error"),n=e.previewElement.querySelectorAll("[data-dz-errormessage]"),r=[],s=0,d=n.length;s<d;s++)o=n[s],r.push(o.textContent=c);return _.isNull(a.dropzone_obj.files)||0!==a.dropzone_obj.files.length||t(a.dropzone_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),r}),a.dropzone_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),a.dropzone_obj.on("error",function(e,a){if(e.accepted)void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback?t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&t(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error);else{var o=i.closest(".ac-form");bp.Nouveau.Activity.clearFeedbackNotice(o),o.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+a+"</div>"),this.removeFile(e),o.removeClass("media-uploading")}}),a.dropzone_obj.on("removedfile",function(e){if(a.dropzone_media.length){for(var o in a.dropzone_media)if(e.upload.uuid==a.dropzone_media[o].uuid){void 0===a.dropzone_media[o].saved||a.dropzone_media[o].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_media[o].id),a.dropzone_media.splice(o,1);break}}if(_.isNull(a.dropzone_obj)||_.isNull(a.dropzone_obj.files)||0!==a.dropzone_obj.files.length)i.closest(".ac-form").addClass("has-content");else{var s=i.parents(".ac-reply-toolbar"),d=i.closest(".ac-form");d.removeClass("has-media"),s.find(".ac-reply-document-button")&&s.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-video-button")&&s.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-gif-button")&&s.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-media-button")&&s.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),t(a.dropzone_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),a.validateCommentContent(d.find(".ac-textarea").children(".ac-input"))}}),a.dropzone_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0&&(i.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),s.removeClass("closed").addClass("open")}else a.dropzone_obj&&void 0!==a.dropzone_obj&&a.dropzone_obj.destroy(),a.dropzone_media=[],s.html(""),s.addClass("closed").removeClass("open");var c=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentDocumentUploader(c),this.destroyCommentVideoUploader(c);var l=t(e.currentTarget).data("ac-id");this.resetGifPicker(l),e.isCustomEvent||t(i).closest(".bp-ac-form-container").find(".dropzone.media-dropzone").trigger("click")},openCommentsDocumentUploader:function(e){var a=this,i=t(e.currentTarget),o=i.data("ac-id"),s=i.closest(".bp-ac-form-container").find("#ac-reply-post-document-uploader-"+o),d=i.closest("#activity-modal").length>0;if(e.preventDefault(),t(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(s.hasClass("open")&&!e.isCustomEvent)return void s.trigger("click")}else t(e.currentTarget).toggleClass("active");var n=document.getElementsByClassName("ac-reply-post-document-template").length?document.getElementsByClassName("ac-reply-post-document-template")[0].innerHTML:"";if(void 0!==window.Dropzone&&s.length)if(s.hasClass("closed")){var r={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:n,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation};a.dropzone_document_obj=new Dropzone((d?"#activity-modal ":"")+"#ac-reply-post-document-uploader-"+i.data("ac-id"),r),a.dropzone_document_obj.on("addedfile",function(e){e.document_edit_data&&a.dropzone_document.push(e.document_edit_data);var o=e.upload.filename,s=o.substr(o.lastIndexOf(".")+1);t(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass("bb-icon-file-"+s);var d=i.parents(".ac-reply-toolbar");d.find(".ac-reply-document-button")&&d.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}),a.dropzone_document_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var o=i.parents(".ac-reply-toolbar");i.closest(".ac-form").addClass("has-media"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-video-button")&&o.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),a.dropzone_document_obj.on("uploadprogress",function(){i.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),a.dropzone_document_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),a.dropzone_document_obj.on("success",function(e,i){if(i.data.id)return e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,i.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,i.data.saved=!1,a.dropzone_document.push(i.data),e.previewElement.classList.add("dz-success");var o,s,d,n,r,c=i.data.feedback;for(e.previewElement.classList.add("dz-error"),n=e.previewElement.querySelectorAll("[data-dz-errormessage]"),r=[],s=0,d=n.length;s<d;s++)o=n[s],r.push(o.textContent=c);return _.isNull(a.dropzone_document_obj.files)||0!==a.dropzone_document_obj.files.length||t(a.dropzone_document_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),r}),a.dropzone_document_obj.on("error",function(e,a){if(e.accepted)void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback?t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&t(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error);else{var o=i.closest(".ac-form");bp.Nouveau.Activity.clearFeedbackNotice(o),o.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+a+"</div>"),this.removeFile(e),o.removeClass("media-uploading")}}),a.dropzone_document_obj.on("removedfile",function(e){if(a.dropzone_document.length){for(var o in a.dropzone_document)if(e.upload.uuid==a.dropzone_document[o].uuid){void 0===a.dropzone_document[o].saved||a.dropzone_document[o].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_document[o].id),a.dropzone_document.splice(o,1);break}}if(_.isNull(a.dropzone_document_obj)||_.isNull(a.dropzone_document_obj.files)||0!==a.dropzone_document_obj.files.length)i.closest(".ac-form").addClass("has-content");else{var s=i.parents(".ac-reply-toolbar"),d=i.closest(".ac-form");d.removeClass("has-media"),s.find(".ac-reply-media-button")&&s.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-video-button")&&s.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-gif-button")&&s.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-document-button")&&s.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),t(a.dropzone_document_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),a.validateCommentContent(d.find(".ac-textarea").children(".ac-input"))}}),a.dropzone_document_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0&&(i.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),s.removeClass("closed").addClass("open")}else a.dropzone_document_obj&&a.dropzone_document_obj.destroy(),a.dropzone_document=[],s.html(""),s.addClass("closed").removeClass("open");var c=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(c),this.destroyCommentVideoUploader(c);var l=t(e.currentTarget).data("ac-id");this.resetGifPicker(l),e.isCustomEvent||t(i).closest(".bp-ac-form-container").find(".dropzone.document-dropzone").trigger("click")},openCommentsVideoUploader:function(e){var a=this,i=t(e.currentTarget),o=i.data("ac-id"),s=i.closest(".bp-ac-form-container").find("#ac-reply-post-video-uploader-"+o),d=i.closest("#activity-modal").length>0;if(e.preventDefault(),t(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(s.hasClass("open")&&!e.isCustomEvent)return void s.trigger("click")}else t(e.currentTarget).toggleClass("active");var n=document.getElementsByClassName("ac-reply-post-video-template").length?document.getElementsByClassName("ac-reply-post-video-template")[0].innerHTML:"";if(void 0!==window.Dropzone&&s.length)if(s.hasClass("closed")){var r={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:n,dictCancelUploadConfirmation:BP_Nouveau.video.dictCancelUploadConfirmation};a.dropzone_video_obj=new Dropzone((d?"#activity-modal ":"")+"#ac-reply-post-video-uploader-"+i.data("ac-id"),r),a.dropzone_video_obj.on("sending",function(e,t,a){a.append("action","video_upload"),a.append("_wpnonce",BP_Nouveau.nonces.video);var o=i.parents(".ac-reply-toolbar");i.closest(".ac-form").addClass("has-media"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-video-button")&&o.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),a.dropzone_video_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.video.empty_video_type):t()}),a.dropzone_video_obj.on("addedfile",function(e){if(e.video_edit_data){a.dropzone_video.push(e.video_edit_data);var o=i.parents(".ac-reply-toolbar");o.find(".ac-reply-video-button")&&o.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}e.dataURL&&e.video_edit_data.thumb.length?(t(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.video_edit_data.thumb+' " />'),t(e.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),a.dropzone_video_obj.on("uploadprogress",function(){i.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),a.dropzone_video_obj.on("success",function(e,i){if(100===e.upload.progress&&(t(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,t(e.previewElement).find(".dz-progress-count").text("100% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),t(e.previewElement).closest(".dz-preview").addClass("dz-complete")),i.data.id)return e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,i.data.group_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,i.data.saved=!1,i.data.js_preview=t(e.previewElement).find(".dz-video-thumbnail img").attr("src"),a.dropzone_video.push(i.data),e.previewElement.classList.add("dz-success");var o,s,d,n,r,c=i.data.feedback;for(e.previewElement.classList.add("dz-error"),n=e.previewElement.querySelectorAll("[data-dz-errormessage]"),r=[],s=0,d=n.length;s<d;s++)o=n[s],r.push(o.textContent=c);return _.isNull(a.dropzone_video_obj.files)||0!==a.dropzone_video_obj.files.length||t(a.dropzone_video_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),r}),a.dropzone_video_obj.on("error",function(e,a){if(e.accepted)void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback?t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&t(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error);else{var o=i.closest(".ac-form");bp.Nouveau.Activity.clearFeedbackNotice(o),o.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+a+"</div>"),this.removeFile(e),o.removeClass("media-uploading")}}),a.dropzone_video_obj.on("removedfile",function(e){if(a.dropzone_video.length){for(var o in a.dropzone_video)if(e.upload.uuid==a.dropzone_video[o].uuid){void 0===a.dropzone_video[o].saved||a.dropzone_video[o].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_video[o].id),a.dropzone_video.splice(o,1);break}}if(_.isNull(a.dropzone_video_obj)||_.isNull(a.dropzone_video_obj.files)||0!==a.dropzone_video_obj.files.length)i.closest(".ac-form").addClass("has-content");else{var s=i.parents(".ac-reply-toolbar"),d=i.closest(".ac-form");d.removeClass("has-media"),s.find(".ac-reply-media-button")&&s.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-document-button")&&s.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-gif-button")&&s.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),s.find(".ac-reply-video-button")&&s.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),t(a.dropzone_video_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),a.validateCommentContent(d.find(".ac-textarea").children(".ac-input"))}}),a.dropzone_video_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0&&(i.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),s.removeClass("closed").addClass("open")}else a.dropzone_video_obj&&a.dropzone_video_obj.destroy(),a.dropzone_video=[],s.html(""),s.addClass("closed").removeClass("open");var c=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(c),this.destroyCommentDocumentUploader(c);var l=t(e.currentTarget).data("ac-id");this.resetGifPicker(l),e.isCustomEvent||t(i).closest(".bp-ac-form-container").find(".dropzone.video-dropzone").trigger("click")},openGifPicker:function(e){e.preventDefault();var a=e.currentTarget,i=t(a).closest("#activity-modal").length>0,o=i?t(".gif-media-search-dropdown-standalone"):t(a).next(),s=!!i,d=a.id.match(/\d+$/)[0],n=t((i?"#activity-modal ":"")+"#ac-reply-post-gif-"+d),r=t(window).scrollTop(),c=t(a).offset(),l=Math.round(c.top),m=Math.round(c.left);if(o.is(":empty")){var p=new bp.Models.ACReply,v=new bp.Views.GifMediaSearchDropdown({model:p,standalone:s}),u=new bp.Views.ActivityAttachedGifPreview({model:p,standalone:s});o.html(v.render().el),n.html(u.render().el),this.models[d]=p}var b=t(a).parents(".ac-textarea ").find(".ac-reply-attachments .activity-attached-gif-container");t(a).hasClass("active")&&b.length&&""==t.trim(b.html())?t(a).removeClass("active"):t(a).addClass("active"),o.toggleClass("open");var f=m+o.width()-70;t(a).parents("li").length>2&&(f=m+o.width()-110),t(a).closest(".post-elements-buttons-item").index()>1&&(f=m+o.width()-180);var y="translate("+f+"px, "+(l-r-5)+"px)  translate(-100%, -100%)";i&&o.css("transform",y),this.destroyCommentMediaUploader(d),this.destroyCommentDocumentUploader(d),this.destroyCommentVideoUploader(d)},toggleMultiMediaOptions:function(e,a,i){if(!_.isUndefined(BP_Nouveau.media)){var o="",s="";i?(o=(a=a?t(a):t(i)).closest(".activity-modal").find(".activity-item"),s=a.closest(".activity-modal").find(".activity-item").data("bp-activity"),e=t(i)):(o=a.closest(".activity-item"),s=a.closest(".activity-item").data("bp-activity")),a.closest("li").data("bp-activity-comment")&&(s=a.closest("li").data("bp-activity-comment")),a.closest("li").hasClass("groups")||o.hasClass("groups")?(_.isUndefined(s.group_media)?!1===BP_Nouveau.media.group_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===s.group_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(s.group_document)?!1===BP_Nouveau.media.group_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===s.group_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(s.group_video)?!1===BP_Nouveau.media.group_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===s.group_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.groups?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.groups?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")):(_.isUndefined(s)||_.isNull(s)||_.isUndefined(s.profile_media)?!1===BP_Nouveau.media.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===s.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(s)||_.isNull(s)||_.isUndefined(s.profile_document)?!1===BP_Nouveau.media.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===s.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(s)||_.isNull(s)||_.isUndefined(s.profile_video)?!1===BP_Nouveau.media.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===s.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.profile?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.profile?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled"))}},fixAtWhoActivity:function(){t(".acomment-content, .activity-content").each(function(){for(var e=t(this).find("span.atwho-query"),a=0;a<e.length;a++)t(e[a]).replaceWith(e[a].innerText)})},navigateToSpecificComment:function(){setTimeout(function(){if(window.location.hash){var e=window.location.hash,a=0!==t("#wpadminbar").length?t("#wpadminbar").innerHeight():0;t(e).length>0&&t("html, body").animate({scrollTop:parseInt(t(e).offset().top)-(80+a)},0)}},200)},createThumbnailFromUrl:function(e){var t=this;t.dropzone_obj.createThumbnailFromUrl(e,t.dropzone_obj.options.thumbnailWidth,t.dropzone_obj.options.thumbnailHeight,t.dropzone_obj.options.thumbnailMethod,!0,function(a){t.dropzone_obj.emit("thumbnail",e,a),t.dropzone_obj.emit("complete",e)})},editActivityCommentForm:function(e,a){var i=e.find('input[name="comment_form_id"]').val(),o=e.find("#ac-reply-toolbar-"+i),s=e.find('input[name="ac_form_submit"]');e.find("#ac-input-"+i).html(a.content);var d=s.attr("data-add-edit-label");if(s.attr("data-add-edit-label",s.val()).val(d),void 0!==a.media&&0<a.media.length){o.find(".ac-reply-media-button").trigger({type:"click",isCustomEvent:!0}),this.disabledCommentDocumentUploader(o),this.disabledCommentVideoUploader(o),this.disabledCommentGifPicker(o);for(var n=!1,r=a.media.length,c=0;c<r;c++){n=!1;var l={};l=0<parseInt(a.id)?{id:a.media[c].attachment_id,media_id:a.media[c].id,name:a.media[c].name,thumb:a.media[c].thumb,url:a.media[c].url,uuid:a.media[c].attachment_id,menu_order:a.media[c].menu_order,album_id:a.media[c].album_id,group_id:a.media[c].group_id,saved:!0}:{id:a.media[c].id,name:a.media[c].name,thumb:a.media[c].thumb,url:a.media[c].url,uuid:a.media[c].id,menu_order:a.media[c].menu_order,album_id:a.media[c].album_id,group_id:a.media[c].group_id,saved:!1},n={name:a.media[c].name,accepted:!0,kind:"image",upload:{filename:a.media[c].name,uuid:a.media[c].attachment_id},dataURL:a.media[c].url,id:a.media[c].attachment_id,media_edit_data:l},this.dropzone_obj&&(this.dropzone_obj.files.push(n),this.dropzone_obj.emit("addedfile",n),(BP_Nouveau.is_as3cf_active,"1"===BP_Nouveau.is_as3cf_active)?(t(this.dropzone_obj.files[c].previewElement).find("img").attr("src",a.media[c].thumb),this.dropzone_obj.emit("thumbnail",a.media[c].thumb),this.dropzone_obj.emit("complete",n)):this.createThumbnailFromUrl(n),this.dropzone_obj.emit("dz-success"),this.dropzone_obj.emit("dz-complete"))}}if(void 0!==a.document&&0<a.document.length){o.find(".ac-reply-document-button").trigger({type:"click",isCustomEvent:!0}),this.disabledCommentMediaUploader(o),this.disabledCommentVideoUploader(o),this.disabledCommentGifPicker(o);for(var m=!1,p=a.document.length,v=0;v<p;v++){m=!1;var u={};u=0<parseInt(a.id)?{id:a.document[v].doc_id,name:a.document[v].full_name,full_name:a.document[v].full_name,type:"document",url:a.document[v].url,size:a.document[v].size,uuid:a.document[v].doc_id,document_id:a.document[v].id,menu_order:a.document[v].menu_order,folder_id:a.document[v].folder_id,group_id:a.document[v].group_id,saved:!0,svg_icon:_.isUndefined(a.document[v].svg_icon)?"":a.document[v].svg_icon}:{id:a.document[v].id,name:a.document[v].full_name,full_name:a.document[v].full_name,type:"document",url:a.document[v].url,size:a.document[v].size,uuid:a.document[v].id,menu_order:a.document[v].menu_order,folder_id:a.document[v].folder_id,group_id:a.document[v].group_id,saved:!1,svg_icon:_.isUndefined(a.document[v].svg_icon)?"":a.document[v].svg_icon},m={name:a.document[v].full_name,size:a.document[v].size,accepted:!0,kind:"file",upload:{filename:a.document[v].full_name,uuid:a.document[v].doc_id},dataURL:a.document[v].url,id:a.document[v].doc_id,document_edit_data:u,svg_icon:_.isUndefined(a.document[v].svg_icon)?"":a.document[v].svg_icon},this.dropzone_document_obj&&(this.dropzone_document_obj.files.push(m),this.dropzone_document_obj.emit("addedfile",m),this.dropzone_document_obj.emit("complete",m))}}if(void 0!==a.video&&0<a.video.length){o.find(".ac-reply-video-button").trigger({type:"click",isCustomEvent:!0}),this.disabledCommentMediaUploader(o),this.disabledCommentDocumentUploader(o),this.disabledCommentGifPicker(o);for(var b=!1,f=a.video.length,y=0;y<f;y++){b=!1;var h={};h=0<parseInt(a.id)?{id:a.video[y].vid_id,name:a.video[y].name,type:"video",thumb:a.video[y].thumb,url:a.video[y].url,size:a.video[y].size,uuid:a.video[y].vid_id,video_id:a.video[y].id,menu_order:a.video[y].menu_order,album_id:a.video[y].album_id,group_id:a.video[y].group_id,saved:!0}:{id:a.video[y].id,name:a.video[y].name,type:"video",thumb:a.video[y].thumb,url:a.video[y].url,size:a.video[y].size,uuid:a.video[y].id,menu_order:a.video[y].menu_order,album_id:a.video[y].album_id,group_id:a.video[y].group_id,saved:!1},console.log(b={name:a.video[y].name,size:a.video[y].size,accepted:!0,kind:"file",upload:{filename:a.video[y].name,uuid:a.video[y].vid_id},dataURL:a.video[y].url,id:a.video[y].vid_id,video_edit_data:h}),console.log(this.dropzone_video_obj),this.dropzone_video_obj&&(this.dropzone_video_obj.files.push(b),this.dropzone_video_obj.emit("addedfile",b),this.dropzone_video_obj.emit("complete",b))}}if(void 0!==a.gif&&0<Object.keys(a.gif).length){var g=o.find(".ac-reply-gif-button").next(),C=t((e.closest("#activity-modal").length>0?"#activity-modal ":"")+"#ac-reply-post-gif-"+i);o.find(".ac-reply-gif-button").trigger("click"),this.disabledCommentMediaUploader(o),this.disabledCommentDocumentUploader(o),this.disabledCommentVideoUploader(o);var N=new bp.Models.ACReply,w=new bp.Views.GifMediaSearchDropdown({model:N}),z=new bp.Views.ActivityAttachedGifPreview({model:N});w.model.set("gif_data",a.gif),g.html(w.render().el),C.html(z.render().el),this.models[i]=N}void 0===a.media&&void 0===a.document&&void 0===a.video&&void 0===a.gif&&e.find(".ac-reply-toolbar .post-elements-buttons-item").removeClass("disable")},resetActivityCommentForm:function(e,a){if(a=void 0!==a?a:"",e.hasClass("acomment-edit")||"hardReset"===a){var i=e.find('input[name="comment_form_id"]').val(),o=e.attr("data-item-id"),s=t('[data-bp-activity-comment-id="'+o+'"]'),d=e.find('input[name="ac_form_submit"]');s.find("#acomment-display-"+o).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id");var n=d.attr("data-add-edit-label");d.attr("data-add-edit-label",d.val()).val(n),e.find(".post-elements-buttons-item").removeClass("disable"),e.find(".post-elements-buttons-item .toolbar-button").removeClass("active"),e.find("#ac-input-"+i).html(""),e.removeClass("has-content has-gif has-media"),this.destroyCommentMediaUploader(i),this.destroyCommentDocumentUploader(i),this.destroyCommentVideoUploader(i),this.resetGifPicker(i)}},reinitializeActivityCommentForm:function(e){var a=e.find('input[name="comment_form_id"]').val(),i=e.find('input[name="ac_form_submit"]');if(e.hasClass("acomment-edit")){var o=e.attr("data-item-id");t('[data-bp-activity-comment-id="'+o+'"]').find("#acomment-display-"+o).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id")}var s=i.attr("data-add-edit-label");i.attr("data-add-edit-label",i.val()).val(s),e.find("#ac-input-"+a).html(""),e.removeClass("has-content has-gif has-media"),t(".bb-modal-activity-footer").addClass("active").append(e),this.destroyCommentMediaUploader(a),this.destroyCommentDocumentUploader(a),this.destroyCommentVideoUploader(a),this.resetGifPicker(a)},disabledCommentMediaUploader:function(e){e.find(".ac-reply-media-button")&&e.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentDocumentUploader:function(e){e.find(".ac-reply-document-button")&&e.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentVideoUploader:function(e){e.find(".ac-reply-video-button")&&e.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentGifPicker:function(e){e.find(".ac-reply-gif-button")&&e.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable")},validateCommentContent:function(e){var a=e.html(),i=t.trim(a.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""));i=i.replace(/&nbsp;/g," "),""!==e.text().trim()||i.indexOf("emojioneemoji")>=0||e.closest("form").hasClass("acomment-edit")?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},ReactionStatePopupTab:function(e){e.preventDefault(),t(this).closest(".activity-state-popup").find(".activity-state-popup_tab_panel li a").removeClass("active"),t(this).addClass("active"),t(this).closest(".activity-state-popup").find(".activity-state-popup_tab_content .activity-state-popup_tab_item").removeClass("active"),t(this).closest(".activity-state-popup").find("."+t(this).data("tab")).addClass("active")},closeActivityState:function(){t(".activity-state-popup").hide().removeClass("active")},listenCommentInput:function(e){if(e.length>0){var a=e.get(0),i=t(a).attr("id")+(t(a).closest(".bb-media-model-inner").length?"-theater":"");if(-1!==t.inArray(i,this.InitiatedCommentForms)&&!t(a).closest("form").hasClass("events-initiated")){var o=this.InitiatedCommentForms.indexOf(i);this.InitiatedCommentForms.splice(o,1)}-1!=t.inArray(i,this.InitiatedCommentForms)||t(a).closest("form").hasClass("events-initiated")||(a.addEventListener("paste",function(e){e.preventDefault();var t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),a.addEventListener("input",function(e){var a,i=jQuery(e.currentTarget).html();a=(a=t.trim(i.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," "),""!==jQuery(e.currentTarget).text().trim()||a.indexOf("emojioneemoji")>=0?jQuery(e.currentTarget).closest("form").addClass("has-content"):jQuery(e.currentTarget).closest("form").removeClass("has-content")}),t(a).closest("form").addClass("events-initiated"),this.InitiatedCommentForms.push(i))}},activityRootComment:function(e){var a=t(e.currentTarget).closest("#activity-modal"),i=a.find(".activity-item").data("bp-activity-id"),o=a.find("#ac-form-"+i);bp.Nouveau.Activity.resetActivityCommentForm(o,"hardReset"),a.find(".acomment-display").removeClass("display-focus"),a.find(".comment-item").removeClass("comment-item-focus"),a.find(".bb-modal-activity-footer").addClass("active").append(o),o.addClass("root"),o.find("#ac-input-"+i).focus(),bp.Nouveau.Activity.clearFeedbackNotice(o)},clearFeedbackNotice:function(e){e.find(".bp-ac-form-container").find(".bp-feedback").length&&e.find(".bp-ac-form-container").find(".bp-feedback").remove()},launchActivityPopup:function(e,a){var i=t("#activity-"+e),o=t(".bb-activity-model-wrapper"),s=i[0].outerHTML,d=i.data("activity-popup-title");bp.Nouveau.Activity.activityHasUpdates=!1,bp.Nouveau.Activity.currentActivityId=null,bp.Nouveau.Activity.activityPinHasUpdates=!1,o.closest("body").addClass("acomments-modal-open"),o.show(),o.find("ul.activity-list").html(s),o.find(".bb-modal-activity-header h2").text(d),o.find(".bb-activity-video-elem").each(function(e,a){var i=t(a);i.find("video").each(function(e,a){var o=t(a),s=o.attr("id")+Math.floor(1e4*Math.random());o.attr("id",s);var d=i.find(".video-action-wrap");o.insertAfter(d),i.find(".video-js").remove(),o.addClass("video-js"),videojs(s,{controls:!0,aspectRatio:"16:9",fluid:!0,playbackRates:[.5,1,1.5,2],fullscreenToggle:!1})})}),i.hasClass("bb-closed-comments")&&o.find("#activity-modal").addClass("bb-closed-comments");var n=o.find("#ac-form-"+e);o.find(".acomment-display").removeClass("display-focus"),o.find(".comment-item").removeClass("comment-item-focus"),o.find(".bb-modal-activity-footer").addClass("active").append(n),n.removeClass("not-initialized").addClass("root"),n.find("#ac-input-"+e).focus(),bp.Nouveau.Activity.clearFeedbackNotice(n),n.removeClass("events-initiated");var r=o.find(".bb-modal-activity-footer").find(".ac-input[contenteditable]");bp.Nouveau.Activity.listenCommentInput(r),o.find(".bb-activity-more-options-wrap .bb-activity-more-options-action, .bb-pin-action_button, .bb-mute-action_button").attr("data-balloon-pos","left"),o.find(".privacy-wrap").attr("data-bp-tooltip-pos","right"),o.find('[data-parent_comment_id="'+a+'"]').children(".acomments-view-more").first().trigger("click"),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!0,"#activity-modal ",e),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp(),bp.Nouveau.Activity.toggleMultiMediaOptions(n,"",".bb-modal-activity-footer")},viewMoreComments:function(e){e.preventDefault();var a=t(e.currentTarget).parent(),i=t(e.currentTarget),o=t(a).data("activity_id"),s=t(e.currentTarget).closest(".activity-comments"),d=t(e.currentTarget).closest(".activity-item"),n=t(a).data("parent_comment_id"),r="",c="";i.addClass("loading").removeClass("acomments-view-more--hide"),s.addClass("active"),d.addClass("active"),i.html('<div id="bp-ajax-loader"><div class="bb-activity-placeholder bb-activity-tiny-placeholder"><div class="bb-activity-placeholder_head"><div class="bb-activity-placeholder_avatar bb-bg-animation bb-loading-bg"></div><div class="bb-activity-placeholder_details"><div class="bb-activity-placeholder_title bb-bg-animation bb-loading-bg"></div><div class="bb-activity-placeholder_description bb-bg-animation bb-loading-bg"></div></div></div></div></div>');var l={action:"activity_loadmore_comments",activity_id:o,parent_comment_id:n,offset:t(e.currentTarget).parents(".activity-comments").find('ul[data-parent_comment_id ="'+n+'"] > li.comment-item:not(.bb-recent-comment)').length,activity_type_is_blog:t(e.currentTarget).parents(".entry-content").length>1};t(e.currentTarget).prev("li.activity-comment").length>0&&(l.last_comment_timestamp=t(e.currentTarget).prev("li.activity-comment").data("bp-timestamp"),l.last_comment_id=c=t(e.currentTarget).prev("li.activity-comment").data("bp-activity-comment-id")),bp.Nouveau.ajax(l,"activity").done(function(e){if(!1===e.success){i.html("<p class='error'>"+e.data.message+"</p>").removeClass("acomments-view-more--hide"),s.removeClass("active"),d.removeClass("active");return}if(void 0!==e.data&&void 0!==e.data.comments){var a=t(".bb-internal-model .activity-comments").find("[data-activity_id='"+o+"'][data-parent_comment_id='"+n+"']"),r=t(t.parseHTML(e.data.comments));if(a.length>0&&r.length>0){if(r.each(function(){if("LI"===this.nodeName&&"undefined"!==this.id&&""!==this.id){var e=this.id,t=a.children("#"+e);t.length>0&&t.remove()}}),void 0!==c&&""!==c){var l=a.find("li.activity-comment[data-bp-activity-comment-id='"+c+"']");l.length>0?l.after(r):a.append(r)}else a.children(".activity-comment.comment-item").length>0?a.children(".activity-comment.comment-item").first().before(r):a.html(r);setTimeout(function(){jQuery(window).scroll()},200)}i.remove(),s.removeClass("active"),d.removeClass("active"),i.hasClass("acomments-view-more--root")||t(".bb-modal-activity-body").scrollTo("#acomment-"+n,500,{offset:0,easing:"swing"}),void 0!==bp.Nouveau&&(bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()),a.find(".bb-activity-more-options-wrap").find(".bb-activity-more-options-action").attr("data-balloon-pos","left")}}).fail(function(e){i.html("<p class='error'>"+e.statusText+"</p>").removeClass("acomments-view-more--hide"),s.removeClass("active"),d.removeClass("active")})},autoloadMoreComments:function(){if(t(".bb-activity-model-wrapper").length>0&&"none"!==t(".bb-activity-model-wrapper").css("display")){var e=t(".bb-modal-activity-body .activity-comments > ul > li.acomments-view-more:not(.loading), .bb-modal-activity-body .activity-comments .activity-actions > ul > li.acomments-view-more:not(.loading)"),a=t(".bb-activity-model-wrapper .bb-modal-activity-body"),i=t(".bb-activity-model-wrapper .bb-modal-activity-body").find(".activity-comments:not(.active)");if(e.length>0&&a.length>0&&i.length>0){var o=t(e).offset().top,s=t(a).scrollTop(),d=s+t(a).height(),n=o-t(a).offset().top+s;n<d&&n+t(e).outerHeight()>s&&t(e).trigger("click").addClass("loading")}setTimeout(function(){jQuery(window).scroll()},200)}},activitySyncOnModalClose:function(e,a){e.preventDefault();var i=(t(e.currentTarget).is(document)?t(".bb-activity-model-wrapper"):t(e.currentTarget).parents(".bb-activity-model-wrapper")).find("ul.activity-list > li").data("bp-activity-id"),o=void 0!==a?a:i,s=t("#activity-stream li.activity-item[data-bp-activity-id="+o+"]");void 0!==bp.Nouveau.Activity.activityPinHasUpdates&&bp.Nouveau.Activity.activityPinHasUpdates?(s.length>0&&s.addClass("activity-sync"),bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities()):s.length>0&&bp.Nouveau.Activity.activityHasUpdates&&(s.addClass("activity-sync"),bp.Nouveau.ajax({action:"activity_sync_from_modal",activity_id:o},"activity").done(function(e){!1!==e.success&&void 0!==e.data&&void 0!==e.data.activity&&(s.replaceWith(t.parseHTML(e.data.activity)),jQuery(window).scroll(),bp.Nouveau.Activity.activityPinHasUpdates&&(bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities()))}).fail(function(e){console.error("Request failed:",e)})),bp.Nouveau.Activity.activityHasUpdates=!1,bp.Nouveau.Activity.activityPinHasUpdates=!1,bp.Nouveau.Activity.currentActivityId=null},discardGifEmojiPicker:function(){var e=t("#activity-modal > .bb-modal-activity-body .activity-item").data("bp-activity-id");t("#activity-modal").length>0&&t(".emojionearea-theatre.show").length>0&&t(".bb-activity-model-wrapper #ac-input-"+e).data("emojioneArea").hidePicker(),t("#activity-modal").length>0&&t(".gif-media-search-dropdown-standalone.open").length>0&&(t(".gif-media-search-dropdown-standalone").removeClass("open"),t("#activity-modal").find(".ac-reply-gif-button").removeClass("active"))},initializeEmojioneArea:function(e,a,i){t.fn.emojioneArea&&t(a+"#ac-input-"+i).emojioneArea({standalone:!0,hideSource:!1,container:a+"#ac-reply-emoji-button-"+i,detachPicker:!!e,containerPicker:e?".emojionearea-theatre":null,autocomplete:!1,pickerPosition:"top",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){t(a+"#ac-input-"+i)[0].emojioneArea.hidePicker();var e,o=t(a+"#ac-form-"+i+" #ac-input-"+i),s=o.html();e=(e=t.trim(s.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," "),""!==o.text()||e.indexOf("emojioneemoji")>=0?o.closest("form").addClass("has-content"):o.closest("form").removeClass("has-content")},picker_show:function(){t(this.button[0]).closest(".post-emoji").addClass("active"),t(".emojionearea-theatre").removeClass("hide").addClass("show")},picker_hide:function(){t(this.button[0]).closest(".post-emoji").removeClass("active"),t(".emojionearea-theatre").removeClass("show").addClass("hide")}}})},openActivityFilter:function(e){e.preventDefault(),t(".bb-subnav-filters-container:not(.bb-subnav-filters-search)").removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false");var a=t(e.currentTarget).parent(".bb-subnav-filters-container");a.addClass("active").find(".subnav-filters-opener").attr("aria-expanded","true"),a.find('input[type="search"]').length&&a.find('input[type="search"]').focus()},closeActivityFilter:function(e){t(e.target).closest(".bb-subnav-filters-container").length||t.each(t(".bb-subnav-filters-container"),function(){t(this).hasClass("bb-subnav-filters-search")?""===t(this).find('input[name="activity_search"]').val()&&t(this).removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false"):t(this).removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false")})},filterActivity:function(e){e.preventDefault();var a=t(e.currentTarget),i=a.closest(".bb-subnav-filters-container");a.parent().addClass("selected").siblings().removeClass("selected"),i.removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false"),i.find(".subnav-filters-opener .selected").text(a.text()),bp.Nouveau.Activity.current_page=1;var o=bp.Nouveau.objectNavParent,s="activity",d=t("#buddypress").find('[data-bp-filter="'+s+'"]').first().val(),n="",r="",c="",l="",m=!1,p=!1;t(o+" [data-bp-object].selected").length&&(n=t(o+" [data-bp-object].selected").data("bp-scope"),a.closest("#bb-subnav-filter-show").length&&(m=!0,t("body").hasClass("my-activity")&&(m=!1,p=!0))),t('#buddypress [data-bp-search="'+s+'"] input[type=search]').length&&(r=t('#buddypress [data-bp-search="'+s+'"] input[type=search]').val()),t(o+" [data-bp-order]").length&&(c=t(o+' [data-bp-order="'+s+'"].selected').data("bp-orderby"));var v=bp.Nouveau.getStorage("bp-"+s);void 0!==v.extras&&(l=v.extras),bp.Nouveau.Activity.heartbeat_data.last_recorded=0;var u={object:s,scope:n,filter:d,search_terms:r,extras:l,order_by:c,save_scope:m,event_element:a};p&&(u.user_timeline=!0),bp.Nouveau.objectRequest(u)}},bp.Nouveau.Activity.start())}(bp,jQuery);
//# sourceMappingURL=buddypress-activity.js.map
